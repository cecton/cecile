#!/usr/bin/env python2

import datetime

WORK_ACCOUNTS = ['openerp.com', 'tinyerp.com']
def disable_autoconnect(account):
    if account not in WORK_ACCOUNTS:
        return False
    now = datetime.datetime.now()
    return (now.hour > 16 or now.hour < 7) and now.weekday() < 5

import sys

sys.path.append("/usr/lib/python2.7/site-packages/gajim")

import common.i18n
import common.configpaths
from common.config import Config

origin_get_per = Config.get_per

def get_per(self, optname, key = None, subname = None): # per_group_of_option
    if optname == 'accounts' and subname == 'autoconnect' and \
       disable_autoconnect(key): 
        sys.stderr.write("INFO: account %s has been disabled!\n" % key)
        return False
    return origin_get_per(self, optname, key = key, subname = subname)

Config.get_per = get_per

exec open("/usr/lib/python2.7/site-packages/gajim/gajim.py")
